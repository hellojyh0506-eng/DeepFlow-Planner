/**
 * rules_db.js - DeepFlow æ™ºèƒ½åœºæ™¯è¯†åˆ«å¼•æ“ (V2.0)
 * æ ¸å¿ƒå‡çº§ï¼šä¸ä»…è¯†åˆ«å¤§ç±»ï¼Œè¿˜èƒ½è¯†åˆ«å…·ä½“åœºæ™¯ï¼Œå¹¶ç»™äºˆ Emoji å’Œç²¾å‡†åé¦ˆã€‚
 */

const SCENARIO_DATABASE = [
    // ============================================================
    // 1. è‹±è¯­/å­¦ä¹ ç±» (Blue System)
    // ============================================================
    {
        category: "è‹±è¯­",
        color: "#007AFF", // è“è‰²ç³»
        scenarios: [
            {
                label: "é›…æ€å± é¸­",
                emoji: "ğŸ‡¬ğŸ‡§",
                keywords: ["é›…æ€", "IELTS", "å‰‘é›…", "å£è¯­", "å¬åŠ›"]
            },
            {
                label: "æ‰˜ç¦å¤‡è€ƒ",
                emoji: "ğŸ‡ºğŸ‡¸",
                keywords: ["æ‰˜ç¦", "TOEFL", "GRE", "SAT", "ETS"]
            },
            {
                label: "è¯æ±‡ç§¯ç´¯",
                emoji: "ğŸ§±",
                keywords: ["å•è¯", "è¯æ±‡", "çº¢å®ä¹¦", "Vocabulary", "Word"]
            },
            {
                label: "åº”è¯•çªå‡»",
                emoji: "âœï¸",
                keywords: ["å››çº§", "å…­çº§", "è€ƒç ”è‹±è¯­", "çœŸé¢˜", "æ¨¡æ‹Ÿ", "Exam"]
            },
            // å…œåº•ï¼ˆå¦‚æœæ²¡åŒ¹é…åˆ°ä¸Šé¢çš„ï¼Œä½†åŒ¹é…åˆ°è¿™äº›ï¼Œå°±ç”¨é€šç”¨æ ‡ç­¾ï¼‰
            {
                label: "è‹±è¯­å­¦ä¹ ",
                emoji: "ğŸ“š",
                keywords: ["è‹±è¯­", "English", "ç¿»è¯‘", "è¯­æ³•", "é˜…è¯»"]
            }
        ]
    },
    {
        category: "å­¦ä¹ ",
        color: "#5856D6", // ç´«è‰²ç³»
        scenarios: [
            {
                label: "ä»£ç ä¿®ä»™",
                emoji: "ğŸ’»",
                keywords: ["ä»£ç ", "ç¼–ç¨‹", "ç®—æ³•", "LeetCode", "Java", "Python", "C++", "Debug"]
            },
            {
                label: "å­¦æœ¯ç ”ç©¶",
                emoji: "ğŸ“",
                keywords: ["è®ºæ–‡", "æ–‡çŒ®", "å®éªŒ", "è¯¾é¢˜", "Research", "Thesis"]
            },
            {
                label: "ç¡¬æ ¸å­¦ç§‘",
                emoji: "ğŸ“",
                keywords: ["æ•°å­¦", "ç‰©ç†", "åŒ–å­¦", "Math", "Physics"]
            },
            {
                label: "æ·±åº¦å­¦ä¹ ",
                emoji: "ğŸ§ ",
                keywords: ["å­¦ä¹ ", "å¤ä¹ ", "ç¬”è®°", "è¯¾ç¨‹", "Study", "ç½‘è¯¾"]
            }
        ]
    },

    // ============================================================
    // 2. è¿åŠ¨/å¥åº·ç±» (Red/Orange System)
    // ============================================================
    {
        category: "è¿åŠ¨",
        color: "#FF3B30", // çº¢è‰²ç³»
        scenarios: [
            {
                label: "æœ‰æ°§ç‡ƒè„‚",
                emoji: "ğŸƒ",
                keywords: ["è·‘", "Run", "é©¬æ‹‰æ¾", "æœ‰æ°§", "è·³ç»³", "å•è½¦"]
            },
            {
                label: "åŠ›é‡ä¸¾é“",
                emoji: "ğŸ‹ï¸",
                keywords: ["å¥èº«", "Gym", "å§æ¨", "æ·±è¹²", "ç¡¬æ‹‰", "ä¸¾é“", "å¢è‚Œ"]
            },
            {
                label: "èº«å¿ƒå¹³è¡¡",
                emoji: "ğŸ§˜",
                keywords: ["ç‘œä¼½", "å†¥æƒ³", "æ™®æ‹‰æ", "Yoga", "æ‹‰ä¼¸"]
            },
            {
                label: "çƒç±»ç«æŠ€",
                emoji: "ğŸ€",
                keywords: ["ç¯®çƒ", "è¶³çƒ", "ç¾½æ¯›çƒ", "ç½‘çƒ", "Ball"]
            },
            {
                label: "æˆ·å¤–æ¢ç´¢",
                emoji: "ğŸ”ï¸",
                keywords: ["çˆ¬å±±", "å¾’æ­¥", "ç™»å±±", "Hiking", "æ¸¸æ³³", "Swim"]
            }
        ]
    },
    {
        category: "å¥åº·",
        color: "#FF9500", // æ©™è‰²ç³»
        scenarios: [
            {
                label: "æ—©ç¡æ—©èµ·",
                emoji: "ğŸ’¤",
                keywords: ["ç¡çœ ", "æ—©ç¡", "ä¼‘æ¯", "Sleep", "åˆä¼‘"]
            },
            {
                label: "å¥åº·é¥®é£Ÿ",
                emoji: "ğŸ¥—",
                keywords: ["è½»é£Ÿ", "å‡è„‚é¤", "åƒç´ ", "Diet", "æ°´æœ"]
            },
            {
                label: "åŒ»ç–—æŠ¤ç†",
                emoji: "ğŸ’Š",
                keywords: ["çœ‹ç—…", "åŒ»é™¢", "è¯", "ä½“æ£€", "ç‰™åŒ»"]
            }
        ]
    },

    // ============================================================
    // 3. ç”Ÿæ´»/å·¥ä½œç±» (Green/Cyan System)
    // ============================================================
    {
        category: "ç”Ÿæ´»",
        color: "#34C759", // ç»¿è‰²ç³»
        scenarios: [
            {
                label: "é‡‡è´­è¡¥ç»™",
                emoji: "ğŸ›’",
                keywords: ["ä¹°èœ", "è¶…å¸‚", "è´­ç‰©", "Shopping", "å¿«é€’"]
            },
            {
                label: "çƒ¹é¥ªæ—¶å…‰",
                emoji: "ğŸ³",
                keywords: ["åšé¥­", "æ–™ç†", "ç‚’èœ", "Cook", "çƒ˜ç„™"]
            },
            {
                label: "å®¶åŠ¡æ•´ç†",
                emoji: "ğŸ§¹",
                keywords: ["æ‰“æ‰«", "æ´—è¡£æœ", "æ•´ç†", "æ¸…æ´", "å®¶åŠ¡"]
            },
            {
                label: "é“²å±å®˜",
                emoji: "ğŸ±",
                keywords: ["çŒ«", "ç‹—", "é“²å±", "é›ç‹—", "Pet"]
            }
        ]
    },
    {
        category: "å·¥ä½œ",
        color: "#00C7BE", // é’è‰²ç³»
        scenarios: [
            {
                label: "å•†åŠ¡ä¼šè®®",
                emoji: "ğŸ¤",
                keywords: ["ä¼šè®®", "Meeting", "å®¢æˆ·", "è°ˆåˆ¤"]
            },
            {
                label: "æ–‡æ¡£è¾“å‡º",
                emoji: "ğŸ“",
                keywords: ["å‘¨æŠ¥", "PPT", "æ–‡æ¡£", "æŠ¥å‘Š", "Report"]
            },
            {
                label: "æ‰“å·¥é­‚",
                emoji: "ğŸ’¼",
                keywords: ["å·¥ä½œ", "åŠ ç­", "Work", "å‡ºå·®", "é‚®ä»¶"]
            }
        ]
    },

    // ============================================================
    // 4. å¨±ä¹/è´¢åŠ¡ (Purple/Yellow System)
    // ============================================================
    {
        category: "å¨±ä¹",
        color: "#AF52DE", // ç´«è‰²
        scenarios: [
            {
                label: "å…‰å½±ä¸–ç•Œ",
                emoji: "ğŸ¬",
                keywords: ["ç”µå½±", "è¿½å‰§", "Netflix", "è§†é¢‘", "Movie"]
            },
            {
                label: "æ¸¸æˆäººç”Ÿ",
                emoji: "ğŸ®",
                keywords: ["æ¸¸æˆ", "Game", "Switch", "Steam", "ç‹è€…", "åƒé¸¡"]
            },
            {
                label: "ç¤¾äº¤èšä¼š",
                emoji: "ğŸ»",
                keywords: ["èšé¤", "å–é…’", "é¥­å±€", "Party", "çº¦ä¼š"]
            }
        ]
    },
    {
        category: "è´¢åŠ¡",
        color: "#FFCC00", // é»„è‰²
        scenarios: [
            {
                label: "æé’±è¦ç´§",
                emoji: "ğŸ’°",
                keywords: ["ç†è´¢", "è‚¡ç¥¨", "åŸºé‡‘", "å·¥èµ„", "æé’±"]
            },
            {
                label: "è´¦å•å¤„ç†",
                emoji: "ğŸ§¾",
                keywords: ["è¿˜æ¬¾", "ç¼´è´¹", "æˆ¿ç§Ÿ", "æŠ¥é”€", "Bill"]
            }
        ]
    }
];

// é»˜è®¤å…œåº•ï¼ˆå½“ä»€ä¹ˆéƒ½åŒ¹é…ä¸åˆ°æ—¶ï¼‰
const DEFAULT_RESULT = { 
    category: "æ—¥å¸¸", 
    label: "Daily", 
    emoji: "ğŸ“Œ", 
    color: "#8E8E93" 
};

/**
 * æ™ºèƒ½è¯†åˆ«å‡½æ•° (V2.0)
 * @param {string} text - ä»»åŠ¡æ–‡æœ¬
 * @returns {Object} - è¿”å› { category, label, emoji, color }
 */
function autoDetectTag(text) {
    if (!text) return DEFAULT_RESULT;
    const cleanText = text.toLowerCase();
    
    // ç¬¬ä¸€å±‚å¾ªç¯ï¼šéå†å¤§ç±» (è‹±è¯­ã€è¿åŠ¨...)
    for (const group of SCENARIO_DATABASE) {
        // ç¬¬äºŒå±‚å¾ªç¯ï¼šéå†å…·ä½“åœºæ™¯ (é›…æ€ã€è·‘æ­¥...)
        for (const scenario of group.scenarios) {
            // ç¬¬ä¸‰å±‚å¾ªç¯ï¼šåŒ¹é…å…³é”®è¯
            if (scenario.keywords.some(k => cleanText.includes(k.toLowerCase()))) {
                return {
                    category: group.category, // å¤§ç±»ï¼šç”¨äºç»Ÿè®¡æˆ–æ’åº
                    label: scenario.label,    // ç²¾å‡†æ ‡ç­¾ï¼šç”¨äºæ˜¾ç¤º (å¦‚ "é›…æ€å± é¸­")
                    emoji: scenario.emoji,    // è¡¨æƒ…ï¼šç”¨äºå¢åŠ æ°›å›´
                    color: group.color        // é¢œè‰²ï¼šç”¨äºè§†è§‰åŒºåˆ†
                };
            }
        }
    }
    
    return DEFAULT_RESULT;
}